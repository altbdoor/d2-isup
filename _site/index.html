<!doctype html>
<html lang="en" color-mode="user">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="./destiny-tricorn.svg" />

    <title>d2-isup &middot; Is Destiny 2 service up?</title>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/mvp.css@1.16.0/mvp.min.css"
    />
    <style>
      .pt-1 {
        padding-top: 1rem;
      }
      .pb-1 {
        padding-bottom: 1rem;
      }
      .text-center {
        text-align: center;
      }

      .btn-mode > * {
        padding: 0.5rem 1rem;
      }
    </style>
  </head>
  <body x-data="root">
    <header>
      <h1 x-text="today.toLocaleString(undefined, fullDateTimeFormat)">...</h1>
      <h2 :hidden="!isMaintenance" hidden>
        <mark>
          <span :hidden="!isMaintenance" hidden>Maintenance has started.</span>
          <span :hidden="!isServerDown" hidden>Server is offline.</span>
        </mark>

        <u :hidden="isServerDown" hidden>Server is still online.</u>
      </h2>

      <h2 :hidden="isMaintenance" hidden>No maintenance at the moment.</h2>
    </header>

    <main>
      <section>
        <canvas id="chart" height="200"></canvas>
      </section>

      <div class="text-center pt-1 pb-1">
        <div>
          <a class="btn-mode" :href="getUrlWithConfig({ mode: '24h' })">
            <b x-show="urlConfig.mode === '24h'">24 hour mode</b>
            <i x-show="urlConfig.mode !== '24h'">24 hour mode</i>
          </a>
          <a class="btn-mode" :href="getUrlWithConfig({ mode: '12h' })">
            <b x-show="urlConfig.mode === '12h'">12 hour mode</b>
            <i x-show="urlConfig.mode !== '12h'">12 hour mode</i>
          </a>
        </div>

        <div>
          <a class="btn-mode" :href="getUrlWithConfig({ end: 12 })">
            <b x-show="urlConfig.end === 12">12 hours range</b>
            <i x-show="urlConfig.end !== 12">12 hours range</i>
          </a>
          <a class="btn-mode" :href="getUrlWithConfig({ end: 24 })">
            <b x-show="urlConfig.end === 24">1 day range</b>
            <i x-show="urlConfig.end !== 24">1 day range</i>
          </a>
          <a class="btn-mode" :href="getUrlWithConfig({ end: 48 })">
            <b x-show="urlConfig.end === 48">2 days range</b>
            <i x-show="urlConfig.end !== 48">2 days range</i>
          </a>
        </div>
      </div>

      <section>
        <template x-for="entry in activeEntries">
          <aside class="entry">
            <b
              x-text="entry.maintenance_time_start.toLocaleString(undefined, fullDateTimeFormat)"
            ></b>
            <ul>
              <li>
                <u>Maintenance start:</u>
                <br />
                <span
                  x-text="entry.maintenance_time_start.toLocaleString(undefined, fullDateTimeFormat)"
                ></span>
              </li>
              <li x-show="entry.server_down_start.getTime() > 1000">
                <u>Server turned off:</u>
                <br />
                <span
                  x-text="entry.server_down_start.toLocaleString(undefined, fullDateTimeFormat)"
                ></span>
              </li>
              <li x-show="entry.server_down_end.getTime() > 1000">
                <u>Server turned on:</u>
                <br />
                <span
                  x-text="entry.server_down_end.toLocaleString(undefined, fullDateTimeFormat)"
                ></span>
              </li>
              <li>
                <u>Maintenance end:</u>
                <br />
                <span
                  x-text="entry.maintenance_time_end.toLocaleString(undefined, fullDateTimeFormat)"
                ></span>
              </li>
            </ul>

            <p x-text="entry.description"></p>
          </aside>
        </template>
      </section>

      <section>
        <div class="pt-1 text-center">
          To be sure, please check the
          <a
            href="https://help.bungie.net/hc/en-us/articles/360049199271-Destiny-Server-and-Update-Status"
            target="_blank"
            referrerpolicy="no-referrer"
            >Server and update status page</a
          >, the
          <a
            href="https://x.com/BungieHelp"
            target="_blank"
            referrerpolicy="no-referrer"
            >official BungieHelp</a
          >, or the
          <a
            href="https://mastodon.social/@bungiehelp"
            target="_blank"
            referrerpolicy="no-referrer"
          >
            unofficial BungieHelp </a
          >.
        </div>
      </section>
    </main>

    <footer class="text-center">
      <hr />
      <a href="https://github.com/altbdoor/d2-isup">GitHub</a>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js"></script>
    <script type="module" src="./javascript/main.mjs"></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.3/dist/cdn.min.js"
    ></script>
  </body>
</html>
